{{ 'zsempiri-homepage.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign pcount   = section.settings.products_to_show
  assign bg       = section.settings.bg_color | default: '#FAF9F6'
  assign show_cnt = section.settings.show_count
  assign pt       = section.settings.padding_top
  assign pb       = section.settings.padding_bottom
-%}

<section
  class="zsempiri-coltabs"
  id="zcoltabs-{{ section.id }}"
  style="background-color: {{ bg }}; padding-top: {{ pt }}px; padding-bottom: {{ pb }}px;"
>
  <div class="zsempiri-coltabs__inner">

    {%- comment -%} ── Fejléc: cím + nyíl navigáció ────────────────── {%- endcomment -%}
    <div class="zsempiri-coltabs__header">
      {%- if section.settings.heading != blank -%}
        <h2 class="zsempiri-coltabs__heading">{{ section.settings.heading }}</h2>
      {%- endif -%}
      <div class="zsempiri-coltabs__nav">
        <button
          class="zsempiri-coltabs__nav-btn"
          id="zcoltabs-prev-{{ section.id }}"
          aria-label="Előző termékek"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polyline points="15 18 9 12 15 6"/>
          </svg>
        </button>
        <button
          class="zsempiri-coltabs__nav-btn"
          id="zcoltabs-next-{{ section.id }}"
          aria-label="Következő termékek"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
        </button>
      </div>
    </div>

    {%- comment -%} ── Tab szűrők ──────────────────────────────────── {%- endcomment -%}
    {%- if section.blocks.size > 1 -%}
      <div class="zsempiri-coltabs__tabs" role="tablist">
        {%- for block in section.blocks -%}
          <button
            class="zsempiri-coltabs__tab{% if forloop.first %} is-active{% endif %}"
            role="tab"
            aria-selected="{{ forloop.first | json }}"
            aria-controls="zctp-{{ block.id }}"
            data-zcoltab="{{ block.id }}"
            {{ block.shopify_attributes }}
          >
            {{- block.settings.label -}}
            {%- if show_cnt and block.settings.collection != blank -%}
              <span class="zsempiri-coltabs__tab-count">{{ block.settings.collection.all_products_count }}</span>
            {%- endif -%}
          </button>
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- comment -%} ── Termék panelek ──────────────────────────────── {%- endcomment -%}
    {%- for block in section.blocks -%}
      <div
        class="zsempiri-coltabs__panel{% if forloop.first %} is-active{% endif %}"
        id="zctp-{{ block.id }}"
        role="tabpanel"
        data-zcolpanel="{{ block.id }}"
      >
        <div class="zsempiri-coltabs__grid" data-zcoltrack>
          {%- if block.settings.collection != blank -%}

            {%- for product in block.settings.collection.products limit: pcount -%}
              {%- assign ccard_alt = product.featured_image.alt | escape -%}
              <div class="zsempiri-ccard">
                <div class="zsempiri-ccard__media-wrap">
                  <a href="{{ product.url }}" class="zsempiri-ccard__img-link" aria-label="{{ product.title | escape }}">
                    <div class="zsempiri-ccard__media">
                      {%- if product.featured_image -%}
                        {{
                          product.featured_image
                          | image_url: width: 700
                          | image_tag:
                            class: 'zsempiri-ccard__img',
                            alt: ccard_alt,
                            loading: 'lazy',
                            widths: '350, 500, 700',
                            sizes: '(min-width: 750px) 346px, 50vw'
                        }}
                      {%- else -%}
                        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg zsempiri-ccard__img' }}
                      {%- endif -%}
                    </div>
                  </a>
                  <div class="zsempiri-ccard__actions">
                    <a href="{{ product.url }}" class="zsempiri-ccard__action-btn" aria-label="{{ product.title | escape }} megtekintése">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                      </svg>
                    </a>
                    <a href="{{ product.url }}" class="zsempiri-ccard__action-btn" aria-label="{{ product.title | escape }} kosárba">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                      </svg>
                    </a>
                  </div>
                </div>
                <a href="{{ product.url }}" class="zsempiri-ccard__info" tabindex="-1" aria-hidden="true">
                  <p class="zsempiri-ccard__title">{{ product.title | truncate: 45 }}</p>
                  <p class="zsempiri-ccard__price">
                    {%- if product.compare_at_price > product.price -%}
                      <span class="zsempiri-ccard__price-sale">{{ product.price | money }}</span>
                      <s class="zsempiri-ccard__price-was">{{ product.compare_at_price | money }}</s>
                    {%- else -%}
                      <span>{{ product.price | money }}</span>
                    {%- endif -%}
                  </p>
                </a>
              </div>
            {%- else -%}
              {%- if request.design_mode -%}
                <p style="padding:2rem 0;opacity:.5;font-family:'Jost',sans-serif;color:var(--zsempiri-wood);">
                  Nincs termék ebben a gyűjteményben.
                </p>
              {%- endif -%}
            {%- endfor -%}

          {%- else -%}
            {%- comment -%} Placeholder — design mode / üres állapot {%- endcomment -%}
            {%- for i in (1..4) -%}
              <div class="zsempiri-ccard zsempiri-ccard--placeholder">
                <div class="zsempiri-ccard__media-wrap">
                  <div class="zsempiri-ccard__media">
                    {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg zsempiri-ccard__img' }}
                  </div>
                  <div class="zsempiri-ccard__actions">
                    <span class="zsempiri-ccard__action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></span>
                    <span class="zsempiri-ccard__action-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></span>
                  </div>
                </div>
                <div class="zsempiri-ccard__info">
                  <p class="zsempiri-ccard__title">Termék neve</p>
                  <p class="zsempiri-ccard__price"><span>12 990 Ft</span></p>
                </div>
              </div>
            {%- endfor -%}
          {%- endif -%}
        </div>
      </div>
    {%- endfor -%}

    {%- comment -%} Design mode — üres section figyelmeztető {%- endcomment -%}
    {%- if request.design_mode and section.blocks.size == 0 -%}
      <div style="padding:3rem 2rem;text-align:center;border:2px dashed rgba(123,81,47,.25);border-radius:1rem;">
        <p style="font-family:'Grandstander',cursive;color:var(--zsempiri-wood);font-size:1.6rem;margin:0;">
          Adj hozzá gyűjtemény tab-okat a section beállításaiban!
        </p>
      </div>
    {%- endif -%}

  </div>
</section>

<script>
(function () {
  var root = document.getElementById('zcoltabs-{{ section.id }}');
  if (!root) return;

  var tabs   = root.querySelectorAll('[data-zcoltab]');
  var panels = root.querySelectorAll('[data-zcolpanel]');

  /* ── Tab váltás ─────────────────────────────────────────── */
  tabs.forEach(function (tab) {
    tab.addEventListener('click', function () {
      var id = tab.getAttribute('data-zcoltab');
      tabs.forEach(function (t) {
        t.classList.remove('is-active');
        t.setAttribute('aria-selected', 'false');
      });
      panels.forEach(function (p) { p.classList.remove('is-active'); });
      tab.classList.add('is-active');
      tab.setAttribute('aria-selected', 'true');
      var panel = root.querySelector('[data-zcolpanel="' + id + '"]');
      if (panel) {
        panel.classList.add('is-active');
        /* Reset scroll when switching tabs */
        var track = panel.querySelector('[data-zcoltrack]');
        if (track) track.scrollLeft = 0;
      }
    });
  });

  /* ── Carousel navigáció ─────────────────────────────────── */
  function activeTrack() {
    var ap = root.querySelector('.zsempiri-coltabs__panel.is-active');
    return ap ? ap.querySelector('[data-zcoltrack]') : null;
  }

  var prevBtn = document.getElementById('zcoltabs-prev-{{ section.id }}');
  var nextBtn = document.getElementById('zcoltabs-next-{{ section.id }}');

  if (prevBtn) {
    prevBtn.addEventListener('click', function () {
      var t = activeTrack();
      if (t) t.scrollBy({ left: -t.clientWidth, behavior: 'smooth' });
    });
  }
  if (nextBtn) {
    nextBtn.addEventListener('click', function () {
      var t = activeTrack();
      if (t) t.scrollBy({ left: t.clientWidth, behavior: 'smooth' });
    });
  }
})();
</script>

{% schema %}
{
  "name": "Zsempiri — Termékek",
  "tag": "section",
  "class": "section",
  "max_blocks": 6,
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Cím",
      "default": "Legújabb termékeink"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Termék / gyűjtemény",
      "min": 4,
      "max": 16,
      "step": 4,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_count",
      "label": "Termékszám mutatása",
      "default": true
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Háttérszín",
      "default": "#FAF9F6"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Felső margó (px)",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Alsó margó (px)",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 48
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Gyűjtemény tab",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Gyűjtemény"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Tab felirat",
          "default": "Kollekció"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Zsempiri — Termékek",
      "blocks": [
        { "type": "tab", "settings": { "label": "Összes" } }
      ]
    }
  ]
}
{% endschema %}
